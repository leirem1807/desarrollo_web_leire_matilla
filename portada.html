<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestión de Adopción de Mascotas</title>
<link rel="stylesheet" href="web.css">
<script>
document.addEventListener("DOMContentLoaded", function() {

const contactoSelect = document.getElementById("contacto-medio");
const contactoIdsDiv = document.getElementById("contacto-ids");

contactoSelect.addEventListener("change", function(){
    contactoIdsDiv.innerHTML = ""; // limpiar inputs anteriores
    const seleccionados = Array.from(contactoSelect.selectedOptions);
    if(seleccionados.length > 5){
        alert("Máximo 5 contactos");
        // Deseleccionar el último seleccionado
        seleccionados[seleccionados.length - 1].selected = false;
        return;
    }
    seleccionados.forEach(opt => {
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = `ID o URL para ${opt.value}`;
        input.classList.add("contacto-id");
        input.minLength = 4;  // mínimo 4 caracteres
        input.maxLength = 50; // máximo 50 caracteres
        contactoIdsDiv.appendChild(input);
        contactoIdsDiv.appendChild(document.createElement("br"));
    });
});

// Validación en el submit
document.getElementById("form-aviso").onsubmit = function(e){
    e.preventDefault();
    
    // ... otras validaciones ...

    const inputsContacto = document.querySelectorAll(".contacto-id");
    for(const input of inputsContacto){
        if(input.value.length < 4 || input.value.length > 50){
            alert("El ID o URL de contacto debe tener entre 4 y 50 caracteres");
            return;
        }
    }

    // ... resto de la función ...
}

    // Hash map de regiones y comunas (solo las 7 primeras regiones)
const comunasPorRegion = {
    "1": ["Arica", "Camarones", "Putre", "General Lagos"],
    "2": ["Iquique", "Alto Hospicio", "Pozo Almonte", "Camiña"],
    "3": ["Antofagasta", "Mejillones", "Taltal", "Sierra Gorda"],
    "4": ["Copiapó", "Caldera", "Tierra Amarilla", "Chañaral"],
    "5": ["La Serena", "Coquimbo", "Andacollo", "Ovalle"],
    "6": ["Valparaíso", "Viña del Mar", "Quilpué", "Villa Alemana"],
    "7": ["Santiago", "Providencia", "Las Condes", "Ñuñoa", "Maipú", "La Florida", "Vitacura"]
};

// Actualizar comunas cuando cambie la región
document.getElementById("region").addEventListener("change", function() {
    const regionSeleccionada = this.value;
    const comunaSelect = document.getElementById("comuna");
    comunaSelect.innerHTML = '<option value="">Seleccione</option>'; // limpiar opciones
    if(comunasPorRegion[regionSeleccionada]){
        comunasPorRegion[regionSeleccionada].forEach(comuna => {
            const option = document.createElement("option");
            option.value = comuna;
            option.text = comuna;
            comunaSelect.appendChild(option);
        });
    }
});
    // Secciones
    const portada = document.getElementById("portada");
    const agregarForm = document.getElementById("agregar-form");
    const listado = document.getElementById("listado");
    const detalle = document.getElementById("detalle");
    const estadisticas = document.getElementById("estadisticas");

    // Botones menú
    document.getElementById("btn-portada").onclick = () => mostrarSeccion("portada");
    document.getElementById("btn-agregar").onclick = () => mostrarSeccion("agregar");
    document.getElementById("btn-listado").onclick = () => mostrarSeccion("listado");
    document.getElementById("btn-estadisticas").onclick = () => mostrarSeccion("estadisticas");

    function mostrarSeccion(seccion) {
        portada.style.display = "none";
        agregarForm.style.display = "none";
        listado.style.display = "none";
        detalle.style.display = "none";
        estadisticas.style.display = "none";


        if(seccion==="portada") portada.style.display="block";
        if(seccion==="agregar") agregarForm.style.display="block";
        if(seccion==="listado") listado.style.display="block";
        if(seccion==="estadisticas") estadisticas.style.display="block";
        if(seccion==="detalle") detalle.style.display="block";
    }

    // Últimos 5 avisos en portada
    const ultimosAvisos = [
        {fecha:"2025-08-01", comuna:"Providencia", sector:"Centro", cantidad:1, tipo:"Perro", edad:"2 años", foto:"img/perro1.jpeg"},
        {fecha:"2025-08-02", comuna:"Nuñoa", sector:"Plaza Nuñoa", cantidad:4, tipo:"Gato", edad:"6 meses", foto:"img/gato2.jpeg"},
        {fecha:"2025-08-03", comuna:"Las condes", sector:"El Golf", cantidad:1, tipo:"Perro", edad:"3 años", foto:"img/perro2.jpeg"},
        {fecha:"2025-08-04", comuna:"Vitacura", sector:"La Dehesa", cantidad:1, tipo:"Gato", edad:"1 año", foto:"img/gato1.jpeg"},
        {fecha:"2025-08-05", comuna:"Providencia", sector:"Centro", cantidad:1, tipo:"Perro", edad:"4 años", foto:"img/perro3.jpeg"},
    ];

    const ultimosTable = document.getElementById("ultimos-table");
    ultimosAvisos.forEach(aviso=>{
        let row = ultimosTable.insertRow();
        row.insertCell().innerText = aviso.fecha;
        row.insertCell().innerText = aviso.comuna;
        row.insertCell().innerText = aviso.sector;
        row.insertCell().innerText = aviso.cantidad;
        row.insertCell().innerText = aviso.tipo;
        row.insertCell().innerText = aviso.edad;
        
        let imgCell = row.insertCell();
        let img = document.createElement("img");
        img.src = aviso.foto;
        img.width = 80;  // ancho
        img.height = 60; // alto
        imgCell.appendChild(img);
    });

    // Formulario agregar aviso
    let fotosCount = 1;
    document.getElementById("btn-agregar-foto").onclick = function() {
        if(fotosCount>=5) { alert("Máximo 5 fotos"); return; }
        fotosCount++;
        const input = document.createElement("input");
        input.type="file";
        input.name="foto";
        input.required = true;
        document.getElementById("fotos-container").appendChild(input);
    }

    document.getElementById("form-aviso").onsubmit = function(e){
        e.preventDefault();

        // Validaciones básicas
        const region = document.getElementById("region").value;
        const comuna = document.getElementById("comuna").value;
        const sector = document.getElementById("sector").value;
        const nombre = document.getElementById("nombre").value;
        const email = document.getElementById("email").value;
        const tipo = document.getElementById("tipo").value;
        const cantidad = document.getElementById("cantidad").value;
        const edad = document.getElementById("edad").value;
        const unidadEdad = document.getElementById("unidad-edad").value;
        const fechaEntrega = document.getElementById("fecha-entrega").value;

        if(!region || !comuna || !nombre || !email || !tipo || !cantidad || !edad || !unidadEdad || !fechaEntrega){
            alert("Debe completar todos los campos obligatorios");
            return;
        }

        if(nombre.length<3 || nombre.length>200){ 
            alert("Nombre inválido"); return; }
        if(email.length>100){ 
            alert("Email demasiado largo"); return; }
        if(cantidad<1 || edad<1){ 
            alert("Cantidad o edad inválida"); return; }
        if(sector.length > 100){
            alert("El sector no puede superar los 100 caracteres");return;}

        // Confirmación
        if(confirm("¿Está seguro que desea agregar este aviso de adopción?")){
            alert("Hemos recibido la información de adopción, muchas gracias y suerte!");
            mostrarSeccion("portada");
            document.getElementById("form-aviso").reset();
            fotosCount = 1;
            document.getElementById("fotos-container").innerHTML='<input type="file" name="foto" required>';
        }
    }

    // Listado de avisos con detalle
    const avisosListado = [
        {fechaPub:"2025-08-01", fechaEnt:"2025-08-03", comuna:"providencia", sector:"Centro", cantidad:1, tipo:"Perro", edad:"2 años", nombre:"Juan", fotos:["img/salchi.jpeg", "img/salchi2.jpeg"]},
        {fechaPub:"2025-08-02", fechaEnt:"2025-08-05", comuna:"vitacura", sector:"condes", cantidad:2, tipo:"Gato", edad:"6 meses", nombre:"Ana", fotos:["img/gato1.jpeg"]},
        {fechaPub:"2025-08-03", fechaEnt:"2025-08-06", comuna:"providencia", sector:"nuñoa", cantidad:1, tipo:"Perro", edad:"3 años", nombre:"Luis" , fotos:["img/perro4.jpeg"]},
        {fechaPub:"2025-08-04", fechaEnt:"2025-08-07", comuna:"providencia", sector:"barrio italia", cantidad:1, tipo:"Gato", edad:"1 año", nombre:"Maria", fotos:["img/perro3.jpeg"]},
        {fechaPub:"2025-08-05", fechaEnt:"2025-08-08", comuna:"providencia", sector:"nuñoa", cantidad:3, tipo:"Perro", edad:"4 meses", nombre:"Pedro", fotos:["img/perro2.jpeg"]},
    ];

    const listadoTable = document.getElementById("listado-table");
    avisosListado.forEach((aviso,i)=>{
        let row = listadoTable.insertRow();
        row.style.cursor="pointer";
        row.insertCell().innerText=aviso.fechaPub;
        row.insertCell().innerText=aviso.fechaEnt;
        row.insertCell().innerText=aviso.comuna;
        row.insertCell().innerText=aviso.sector;
        row.insertCell().innerText=aviso.cantidad;
        row.insertCell().innerText=aviso.tipo;
        row.insertCell().innerText=aviso.edad;
        row.insertCell().innerText=aviso.nombre;
        row.insertCell().innerText=aviso.fotos.length;

        row.onclick = ()=>{
            mostrarSeccion("detalle");
            const detalleDiv = document.getElementById("detalle-info");
            detalleDiv.innerHTML = `<p>Fecha publicación: ${aviso.fechaPub}</p>
                                    <p>Fecha entrega: ${aviso.fechaEnt}</p>
                                    <p>Comuna: ${aviso.comuna}</p>
                                    <p>Sector: ${aviso.sector}</p>
                                    <p>Cantidad: ${aviso.cantidad}</p>
                                    <p>Tipo: ${aviso.tipo}</p>
                                    <p>Edad: ${aviso.edad}</p>
                                    <p>Nombre: ${aviso.nombre}</p>                                    
                                    <div id="fotos-detalle"></div>
                                    <br>
                
                                   `;
       


            const fotosDiv = document.getElementById("fotos-detalle");
            aviso.fotos.forEach(src=>{
                const img = document.createElement("img");
                img.src=src;
                img.alt = "Foto del aviso";
                img.style.width="320px";
                img.style.height="240px";
                img.style.margin="5px";
                img.style.cursor="pointer";

                img.onclick=()=>{
                    const overlay = document.createElement("div");
                    overlay.style.position="fixed";
                    overlay.style.top="0";
                    overlay.style.left="0";
                    overlay.style.width="100%";
                    overlay.style.height="100%";
                    overlay.style.background="rgba(0,0,0,0.8)";
                    overlay.style.display="flex";
                    overlay.style.alignItems="center";
                    overlay.style.justifyContent="center";
                    overlay.style.zIndex="1000";


                    const imgLarge = document.createElement("img");
                    imgLarge.src=src;
                    imgLarge.style.width="800px";
                    imgLarge.style.height="600px";

                    const btnClose = document.createElement("button");
                    btnClose.innerText="Cerrar";
                    btnClose.style.position="absolute";
                    btnClose.style.top="20px";
                    btnClose.style.right="20px";
                    btnClose.style.padding="10px";
                    btnClose.onclick=()=>document.body.removeChild(overlay);
                   
                    overlay.appendChild(imgLarge);
                    overlay.appendChild(btnClose);
                    document.body.appendChild(overlay);
                }
                fotosDiv.appendChild(img);
            });
        }
    });

});
</script>
</head>
<body>

<!-- Menú -->
<nav>
<button id="btn-portada">Portada</button>
<button id="btn-agregar">Agregar aviso de adopción</button>
<button id="btn-listado">Ver listado de adopciones</button>
<button id="btn-estadisticas">Estadísticas</button>
</nav>

<!-- Portada -->
<section id="portada">
<h1>Bienvenido al sistema de adopción de mascotas</h1>
<h2>Últimos 5 avisos de adopción</h2>
<table  id="ultimos-table">
<tr><th>Fecha</th><th>Comuna</th><th>Sector</th><th>Cantidad</th><th>Tipo</th><th>Edad</th><th>Foto</th></tr>
</table>
</section>

<!-- Formulario agregar aviso -->
<section id="agregar-form" style="display:none">
<h2>Agregar aviso de adopción</h2>
<form id="form-aviso">
<h3>Información del lugar de entrega</h3>
Región: <select id="region" required>
<option value="">Seleccione</option><option value="1">Arica y Parinacota</option>
    <option value="2">Tarapacá</option>
    <option value="3">Antofagasta</option>
    <option value="4">Atacama</option>
    <option value="5">Coquimbo</option>
    <option value="6">Valparaíso</option>
    <option value="7">Metropolitana de Santiago</option>
</select><br>
Comuna: <select id="comuna" required>
<option value="">Seleccione</option><option>Comuna 1</option><option>Comuna 2</option>
</select><br>
Sector: <input type="text" id="sector" maxlength="100"><br>

<h3>Datos de contacto</h3>
Nombre: <input type="text" id="nombre" required><br>
Email: <input type="email" id="email" required placeholder="@gmail.com"><br>
Número celular: <input type="tel" placeholder="+NNN.NNNNNNNN"><br>
Contactar por: <select id="contacto-medio" multiple>
    <option value="whatsapp">whatsapp</option>
    <option value="telegram">telegram</option>
    <option value="X">X</option>
    <option value="instagram">instagram</option>
    <option value="tiktok">tiktok</option>
    <option value="otra">otra</option>
</select><br>
<div id="contacto-ids"></div>
<h3>Información de la mascota</h3>
Tipo: <select id="tipo" required><option value="">Seleccione</option><option>Perro</option><option>Gato</option></select><br>
Cantidad: <input type="number" id="cantidad" required min="1"><br>
Edad: <input type="number" id="edad" required min="1"><br>
Unidad de medida: <select id="unidad-edad" required><option value="">Seleccione</option><option>meses</option><option>años</option></select><br>
Fecha disponible: <input type="datetime-local" id="fecha-entrega" required><br>
Descripción:<br>
<textarea cols="50" rows="10"></textarea><br>

Fotos: <div id="fotos-container"><input type="file" name="foto" required></div>
<button type="button" id="btn-agregar-foto">Agregar otra foto</button><br><br>

<button type="submit">Agregar este aviso de adopción</button>
</form>
</section>

<!-- Listado -->
<section id="listado" style="display:none">
<h2>Listado de avisos de adopción</h2>
<table  id="listado-table">
<tr>
<th>Fecha Pub</th><th>Fecha Ent</th><th>Comuna</th><th>Sector</th>
<th>Cantidad</th><th>Tipo</th><th>Edad</th><th>Nombre</th><th>Total fotos</th>
</tr>
</table>
</section>

<!-- Detalle aviso -->
<section id="detalle" style="display:none">
<h2>Detalle del aviso</h2>
<div id="detalle-info"></div>
<button onclick="document.getElementById('detalle').style.display='none';document.getElementById('listado').style.display='block';">Volver al listado</button>
<button onclick="document.getElementById('detalle').style.display='none';document.getElementById('portada').style.display='block';">Volver a portada</button>
</section>

<!-- Estadísticas -->
<section id="estadisticas" style="display:none">
<h2>Estadísticas</h2>
<img src="img/grafico_lineas.png" alt="grafico de lineas" width="800"><br>
<img src="img/grafico_torta.png" alt="grafico de torta" width="800"><br>
<img src="img/grafico_barras.png" alt="grafico de barras" width="800"><br>
<button onclick="document.getElementById('estadisticas').style.display='none';document.getElementById('portada').style.display='block';">Volver a portada</button>
</section>

</body>
</html>
